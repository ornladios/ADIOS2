# XRootD configuration for HTTP-based SSI service
# Designed for deployment behind Spin Ingress (which terminates TLS)

# Admin/home/pid paths for xrootd instance
all.adminpath /var/spool/xrootd
all.pidpath /run/xrootd
xrd.homepath /tmp

# Enable SSI filesystem
xrootd.fslib libXrdSsi.so

# Export path for SSI operations
all.export /etc nolock r/w

# SSI stat library
oss.statlib -2 libXrdSsi.so

# Load ADIOS2 SSI service plugin
ssi.svclib /usr/local/lib64/libadios2_xrootd.so

# Native XRootD protocol on 1094 (not exposed externally)
xrd.port 1094

# Enable HTTP protocol on port 8080 (plain HTTP, no TLS)
# Spin Ingress terminates TLS and forwards plain HTTP to container
xrd.protocol http:8080 libXrdHttp.so

# SSL certificate configuration (required for http.exthandler to load)
# Even though we're behind Spin Ingress which terminates TLS,
# XRootD requires TLS to be configured for external handlers
http.cert /tmp/server.crt
http.key /tmp/server.key

# Load HTTP-to-SSI bridge handler for /ssi endpoint
# This routes HTTP POST requests to the SSI service
# Format: http.exthandler <name> <library> [<params>]
http.exthandler adios2ssi /usr/local/lib64/libadios2_xrootd_http.so ssilib=/usr/local/lib64/libadios2_xrootd.so
